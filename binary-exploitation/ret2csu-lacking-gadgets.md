---
description: 09/21/2023
---

# ⁉ ret2csu -- Lacking Gadgets?

> As of lately, when exploiting 64-bit binaries (requiring populating registers for exploitation), I have been running into issues with not hacking proper gadgets.&#x20;
>
> I believe this is mainly because of newer `gcc` versions becoming more and more strict with gadget usage and becoming more secure over time.
>
> Although I have heard talk that **ret2csu** is dead, perhaps this could point me in the right direction?

NOTE: Still a work in progress. Don't worry there's lots more to come ;).

## Introduction

<mark style="color:yellow;">This is a technique that is used when you need to attack a 64-bit binary that requires the attacker to control registers when gadgets are lacking</mark> (primarily because of small binary size or newer `gcc` versions).

This method also allows us to be able to <mark style="color:yellow;">bypass ASLR</mark>.

When an application is dynamically compiled with `libc` linked to it, there is a selection of functions contained within it to allow for the linking process.

These functions contain a few gadgets that we can utilize to populate registers that we are lacking gadgets for.

Most importantly, <mark style="color:yellow;">`__libc_csu_init`</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">contains two gadgets that we are interested in</mark>:

1.

```
0x004011a2      5b             pop rbx
0x004011a3      5d             pop rbp
0x004011a4      415c           pop r12
0x004011a6      415d           pop r13
0x004011a8      415e           pop r14
0x004011aa      415f           pop r15
0x004011ac      c3             ret
```

2.

```
0x00401188      4c89f2         mov rdx, r14                ; char **ubp_av
0x0040118b      4c89ee         mov rsi, r13                ; int argc
0x0040118e      4489e7         mov edi, r12d               ; func main
0x00401191      41ff14df       call qword [r15 + rbx*8]
```

## References

{% embed url="https://i.blackhat.com/briefings/asia/2018/asia-18-Marco-return-to-csu-a-new-method-to-bypass-the-64-bit-Linux-ASLR-wp.pdf" %}
