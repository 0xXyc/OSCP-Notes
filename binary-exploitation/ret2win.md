---
description: ROP Emporium!
---

# ret2win

## ret2win (AMDv5)

* Obtain binary

#### Perform File Checks:

* Run <mark style="color:yellow;">`file`</mark> against the target binary

<figure><img src="../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

#### View what protections have been enabled on the binary:&#x20;

* Run <mark style="color:yellow;">`checksec`</mark> on the binary

<figure><img src="../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

* We see that <mark style="color:red;">NX is enabled</mark>, this is the No <mark style="color:red;">eXecute bit</mark> that is also known as <mark style="color:red;">Data Execution Prevention -- DEP</mark>
* This <mark style="color:yellow;">technology marks certain ares of the program as executable</mark>
* Meaning that stored input cannot be executed as code
* The same type of information (even slightly more verbose) can be obtained using <mark style="color:yellow;">`rabin2`</mark>
  * <mark style="color:yellow;">`-I`</mark> will give lots of information pertaining to binary information

<figure><img src="../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

* <mark style="color:yellow;">`-i`</mark> will show a list of functions that have been imported

<figure><img src="../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

* printf, libc, puts, printf are all interesting
* To view ALL user-created functions, you will utilize <mark style="color:yellow;">`rabin2 -qs <binary>`</mark>

<figure><img src="../.gitbook/assets/image (6) (1).png" alt=""><figcaption></figcaption></figure>

* This is nice, but it is a little verbose, let's utilize grep and search for more filtered information
* This is more likely to give us a list of <mark style="color:yellow;">USEFUL</mark> functions:&#x20;

```
rabin2 -qs ret2win32 | grep -ve imp -e ' 0 '
```

<figure><img src="../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

* Next, we will utilize the classic <mark style="color:yellow;">`strings`</mark> binary that we often utilize in CTF's in an attempt to find any useful information or other secrets
  * \-n 8 will be useful for only printing strings greater than 8 chars

<figure><img src="../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

* Pay attention to <mark style="color:yellow;">/bin/cat flag.txt as this is the command that will be used to output our flag!</mark>
* However, using rabin2 may be a better idea!

```
rabin2 -z ret2win32
```

<figure><img src="../.gitbook/assets/image (1) (6).png" alt=""><figcaption></figcaption></figure>

#### radare2

Updating prior to use

Start radare2 inspection of ret2win32:

```
radare2 ret2win32
```

Run update command:

```
r2pm -U

r2pm -ci r2dec
```

#### gef

{% embed url="https://github.com/hugsy/gef" %}

Setup:

```
bash -c "$(wget https://gef.blah.cat/sh -O -)"
```

Use with GDB:

```
gdb -q
pi import urllib.request as u, tempfile as t; g=t.NamedTemporaryFile(suffix='-gef.py'); open(g.name, 'wb+').write(u.urlopen('https://tinyurl.com/gef-main').read()); gdb.execute('source %s' % g.name)
```

## pwndbg

* I modified `gdbinit.py` to automatically invoke `pwndbg` at startup

Start analyzing ret2win with pwndbg:

```
gdb ret2win
```

Obtaining info of functions and symbols:

```
info functions
```

<figure><img src="../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

Dump assembly:

```
disassemble ret2win
```

<figure><img src="../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

View assembly of `pwnme` function:

```
disassemble pwnme
```

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

## GDB-Multiarch

Throw binary into pwndbg:

```
pwn debug --exec <path_to_binary>
```

Running program:

<figure><img src="../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

Viewing Registers:

<figure><img src="../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>
