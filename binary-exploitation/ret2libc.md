---
description: 08/23/2023
---

# ret2libc

## Introduction

This is primarily the attack you will use when you notice that the <mark style="color:yellow;">NX protection</mark> is <mark style="color:green;">ENABLED</mark> on the binary that you are attacking. This means that <mark style="color:yellow;">you do NOT have an executable stack to mess around with</mark>. This is because <mark style="color:yellow;">the stack memory is protected with the no execute (NX) bit enabled</mark>.

**Why does this matter to us?**&#x20;

Well, in a typical stack-based buffer overflow, an attacker will be able to write their shellcode into the vulnerable program's stack and be able to execute it on the stack.

But, <mark style="color:yellow;">if</mark> the NX bit is <mark style="color:yellow;">ENABLED</mark>, we will <mark style="color:red;">not</mark> be able to execute our shellcode from the vulnerable program's stack.

**How does ret2libc work?**

<mark style="color:yellow;">This attack allows us to bypass the NX bit protection and divert the program's execution by re-using part of executable code found in the</mark> <mark style="color:green;">`libc`</mark> <mark style="color:yellow;">library</mark>. Note that this library is already automatically linked dynamically at compile time and loaded into the program's virtual memory space.

Let's reference this great diagram from ired team:

<figure><img src="../.gitbook/assets/image (98).png" alt=""><figcaption></figcaption></figure>

Breakdown of what's going on:

1. <mark style="color:yellow;">The EIP</mark> is being <mark style="color:yellow;">overwritten</mark> with the address of the `system()` function found in the `libc` library
2. <mark style="color:yellow;">Right after the address of</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">`system()`</mark>, there's an address of the function `exit()`, this is so that once `system()` returns, the vulnerable program will jump to `exit()` which lives in the `libc` library as well. This is so that the vulnerable program will exit gracefully and as expected.
3. <mark style="color:yellow;">Right after the address of</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">`exit()`</mark>, there's a pointer to a memory location that <mark style="color:yellow;">contains the string</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">`/bin/sh`</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">which is the argument that will be passed to</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">`system()`</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">to execute a</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">`/bin/sh`</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">shell for us,</mark> <mark style="color:green;">**granting us a shell**</mark>.&#x20;

We can see the NX bit is enabled on this 32-bit binary here:

<figure><img src="../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

We will be referencing CryptoCat's tutorial on **ret2libc** for this explanation and guide:

{% embed url="https://www.youtube.com/watch?v=0CFWHjc4B-I" %}

