---
description: 09/20/2023
---

# â˜  Bypassing Address Space Layout Randomization (ret2plt)

This will feature x86 and x64-based exploitation.

## Introduction

**Need a refresher on ASLR?**

{% content-ref url="memory-protections/address-space-layout-randomization-aslr.md" %}
[address-space-layout-randomization-aslr.md](memory-protections/address-space-layout-randomization-aslr.md)
{% endcontent-ref %}

<mark style="color:yellow;">Address Space Layout Randomization</mark>, or <mark style="color:yellow;">ASLR</mark> is very similar to PIE.&#x20;

However, it is <mark style="color:yellow;">implemented at the kernel level of the underlying operating system</mark>.

<mark style="color:yellow;">The base address of the string and the functions are going to be randomized with each execution of the binary</mark>.

With <mark style="color:green;">ASLR enabled</mark>, you can visualize this by running `ldd` against your target binary a few times:

<figure><img src="../.gitbook/assets/image (145).png" alt=""><figcaption></figcaption></figure>

### How Does ret2plt Work?

Here, we will be taking advantage of the <mark style="color:yellow;">**ret2plt**</mark> technique that <mark style="color:yellow;">involves calling</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">`puts@plt`</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">and passing the GOT entry of</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">`puts()`</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">as a parameter</mark>.

This will cause <mark style="color:yellow;">`puts()`</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">to print out its own address in</mark> <mark style="color:yellow;"></mark><mark style="color:yellow;">`libc`</mark>.

* How cool is that?!

This will allow us to leak the ASLR base. Essentially, we need to craft a payload that leaks the real address of `puts()`.&#x20;

As we learned in [overwriting-global-offset-table-got.md](overwriting-global-offset-table-got.md "mention"), <mark style="color:yellow;">we know that calling the PLT entry of the function is the same as calling the function itself</mark>. If we point the parameter to the GOT entry, it will print out it's location/address.

This is because C string arguments for functions take pointers of where the string can be found.

Ultimately, pointing it to the GOT entry will print it out.

### References

{% embed url="https://ir0nstone.gitbook.io/notes/types/stack/aslr/ret2plt-aslr-bypass" %}

{% embed url="https://sharkmoos.medium.com/binary-exploitation-exploiting-ret2libc-328eefb0421b" %}

## Exploitation (x86)

### Source Code

`vuln-32.c`:

```c
#include <stdio.h>

void vuln() {
    puts("Come get me");

    char buffer[20];
    gets(buffer);
}

int main() {
    vuln();

    return 0;
}
```

### Exploit Code

exploit.py:

```python
```
