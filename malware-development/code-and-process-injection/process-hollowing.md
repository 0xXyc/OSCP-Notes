---
description: 06-21-2023
---

# ðŸ•³ Process Hollowing

## Introduction

This technique occurs when <mark style="color:yellow;">malware unmaps (hollows out) the legitimate code from memory of the target process</mark>.

It then <mark style="color:yellow;">overwrites the memory space of the target process with a malicious executable</mark>.

## High Level Explanation

1. <mark style="color:green;">Suspended</mark> state CreateProcess()
2. <mark style="color:green;">Waits</mark> for ResumeThread()
3. <mark style="color:green;">Swaps out contents</mark> of the legitimate file with the malicious payload with ZwUnmapViewOfSection() or NtUnmapViewOfSection()                                                                                                                                      "If the call to this function occurs in user mode, you should use the name "NtUnmapViewOfSection" instead of "**ZwUnmapViewOfSection**"."
4. LLoader then perfoms VirtualAllocEx() to <mark style="color:green;">allocate</mark> new memory for the malware
5. WriteProcessMemory() will <mark style="color:green;">write</mark> each of the malware's sections to the swapped out target process space
6. The <mark style="color:green;">entrypoint</mark> for the malicious code is set with SetThreadContext()
7. The malware then <mark style="color:green;">resumes</mark> the thread with ResumeThread() to take it out of the suspended state

[CreateProcess()](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) -> [ResumeThread()](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-resumethread) -> [Zw/NtUnmapViewOfSection()](https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-zwunmapviewofsection) -> [VirtualAllocEx()](https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex) -> [WriteProcessMemory()](https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-writeprocessmemory) -> [SetThreadContext()](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadcontext) -> [ResumeThread()](https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-resumethread)

## Work in progress.
