---
description: 07/17/2023
---

# 3âƒ£ Stack Three

> Stack Three looks at overwriting function pointers stored on the stack.

#### Hints

* You can use `gdb` and `objdump` to determine where the `complete_level()` <mark style="color:yellow;">function</mark> <mark style="color:yellow;">is in memory</mark>.

## Source Code

```c
/*
 * phoenix/stack-three, by https://exploit.education
 *
 * The aim is to change the contents of the changeme variable to 0x0d0a090a
 *
 * When does a joke become a dad joke?
 *   When it becomes apparent.
 *   When it's fully groan up.
 *
 */

#include <err.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define BANNER \
  "Welcome to " LEVELNAME ", brought to you by https://exploit.education"

char *gets(char *);

void complete_level() {
  printf("Congratulations, you've finished " LEVELNAME " :-) Well done!\n");
  exit(0);
}

int main(int argc, char **argv) {
  struct {
    char buffer[64];
    volatile int (*fp)();
  } locals;

  printf("%s\n", BANNER);

  locals.fp = NULL;
  gets(locals.buffer);

  if (locals.fp) {
    printf("calling function pointer @ %p\n", locals.fp);
    fflush(stdout);
    locals.fp();
  } else {
    printf("function pointer remains unmodified :~( better luck next time!\n");
  }

  exit(0);
}
```

Our main goal is to find out where the `changeme()` variable is.

Once we locate it in memory, we need to change the value to: `0x0d0a090a`.

* `0x0d0a090a`
* `\x0a\x09\x0a\x0d`

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

## GDB

```
gdb stack-three
```

Let's check out the disassembly for the `main()` function:

<figure><img src="../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

Let's check out the disassembly for the `complete_level()` function:

<figure><img src="../../.gitbook/assets/image (60).png" alt=""><figcaption></figcaption></figure>

